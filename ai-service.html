<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AI Risk Control | KhonKaen HiTech</title>

<style>
:root{--gold:#d4af37;--red:#ff4d4d;--green:#2ecc71}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,Segoe UI;background:#0c0f14;color:#eee}
header{padding:14px;text-align:center;border-bottom:3px solid var(--gold)}
h1{margin:0;color:var(--gold);font-size:1.2rem}
small{color:#aaa}
#app{max-width:920px;margin:auto}
.chat{padding:14px;min-height:62vh}
.msg{margin-bottom:12px}
.user{text-align:right}
.bubble{display:inline-block;max-width:88%;padding:13px;border-radius:14px;line-height:1.6}
.user .bubble{background:#263445;border-bottom-right-radius:4px}
.bot .bubble{background:#1a202c;border-left:5px solid var(--gold)}
.input{display:flex;gap:8px;padding:12px;border-top:1px solid #222}
input{flex:1;padding:14px;border-radius:8px;border:none;font-size:1rem}
button{padding:0 18px;border:none;border-radius:8px;background:var(--gold);font-weight:800}
.cta{margin-top:12px;padding:14px;border:2px solid var(--gold);border-radius:12px;background:#0b0e13}
.cta strong{color:var(--red)}
.cta a{display:block;margin-top:10px;padding:14px;border-radius:8px;text-align:center;text-decoration:none;font-weight:900}
.call{background:var(--red);color:#fff}
.line{background:var(--green);color:#111}
#dash{position:fixed;right:10px;bottom:10px;background:#000;padding:10px;border-radius:10px;font-size:.75rem;opacity:.9}
@media(max-width:520px){
  .bubble{max-width:92%}
  button{padding:0 14px}
}
</style>
</head>

<body>

<header>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</h1>
  <small>‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô‡πÑ‡∏Æ‡πÄ‡∏ó‡∏Ñ ¬∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏î = ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</small>
</header>

<div id="app">
  <div class="chat" id="chat">
    <div class="msg bot"><div class="bubble">
      ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô‡πÑ‡∏Æ‡πÄ‡∏ó‡∏Ñ<br>
      ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏ú‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∑‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏•‡∏∏‡∏Å‡∏•‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á<br><br>
      ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö
    </div></div>
  </div>

  <div class="input">
    <input id="input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö‚Ä¶" />
    <button onclick="send()">‡∏™‡πà‡∏á</button>
  </div>
</div>

<div id="dash">
  Emergency: <span id="ec">0</span><br>
  Normal: <span id="nc">0</span>
</div>

<script>
/* ================= CONFIG ================= */
const API_KEY="PUT_API_KEY";
const PHONE="0944749874";
const LINE_URL="https://line.me/ti/p/~KKHITECH";

/* ================= TIME ================= */
const hour=new Date().getHours();
const NIGHT=(hour>=20||hour<6);

/* ================= STATE ================= */
let LOCK=false, MSG_COUNT=0, CASE="NORMAL";
let EM=0, NR=0;

/* ================= TRIGGERS ================= */
const EMERGENCY_WORDS=["‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ","‡∏Ñ‡∏ß‡∏±‡∏ô","‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÑ‡∏´‡∏°‡πâ","‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÑ‡∏ü","‡πÑ‡∏ü‡∏î‡∏π‡∏î","‡∏ä‡πá‡∏≠‡∏ï","‡πÄ‡∏ö‡∏£‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏î","‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î"];
const HIGH_INTENT_WORDS=["‡∏Å‡∏•‡∏±‡∏ß","‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢","‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢","‡∏û‡∏±‡∏á","‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ã‡πà‡∏≠‡∏°","‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ß‡πâ","‡∏Ñ‡∏∏‡πâ‡∏°‡πÑ‡∏´‡∏°","‡πÅ‡∏û‡∏á‡πÑ‡∏´‡∏°"];

/* ================= PERSONA PROFILES ================= */
const PERSONA={
  electric:{k:["‡πÑ‡∏ü","‡πÄ‡∏ö‡∏£‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå","‡∏™‡∏≤‡∏¢‡πÑ‡∏ü","‡∏ï‡∏π‡πâ‡πÄ‡∏°‡∏ô","‡∏õ‡∏•‡∏±‡πä‡∏Å"],base:8,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏û‡∏π‡∏î‡∏™‡∏±‡πâ‡∏ô ‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡∏≤‡∏¢`},
  heat:{k:["‡∏£‡πâ‡∏≠‡∏ô","‡πÑ‡∏´‡∏°‡πâ","‡∏Å‡∏•‡∏¥‡πà‡∏ô","‡∏Ñ‡∏ß‡∏±‡∏ô"],base:9,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏•‡∏∏‡∏Å‡∏•‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏´‡πâ‡∏≤‡∏°‡∏Ç‡∏≤‡∏¢`},
  hvac:{k:["‡πÅ‡∏≠‡∏£‡πå","‡πÑ‡∏°‡πà‡πÄ‡∏¢‡πá‡∏ô","‡∏ô‡πâ‡∏≥‡∏´‡∏¢‡∏î"],base:5,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°`},
  security:{k:["‡∏Å‡∏•‡πâ‡∏≠‡∏á","cctv","‡πÇ‡∏à‡∏£","‡∏Ç‡πÇ‡∏°‡∏¢"],base:6,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö`},
  network:{k:["‡πÄ‡∏ô‡πá‡∏ï","wifi","‡∏´‡∏•‡∏∏‡∏î","‡∏ä‡πâ‡∏≤"],base:4,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•`},
  general:{k:[],base:3,
    prompt:`‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏û‡∏π‡∏î‡∏™‡∏±‡πâ‡∏ô ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°`}
};

function detectPersona(t){
  for(const p in PERSONA){
    if(PERSONA[p].k.some(w=>t.includes(w))) return p;
  }
  return "general";
}

/* ================= UI ================= */
function add(role,html){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.innerHTML=`<div class="bubble">${html}</div>`;
  document.getElementById("chat").appendChild(d);
  document.getElementById("chat").scrollTop=999999;
}

/* ================= CORE ================= */
async function send(){
  const input=document.getElementById("input");
  const t=input.value.trim();
  if(!t||LOCK) return;
  input.value="";
  add("user",t);
  MSG_COUNT++;

  // Detect emergency / intent
  const isEmergency=EMERGENCY_WORDS.some(w=>t.includes(w));
  const isHigh=HIGH_INTENT_WORDS.some(w=>t.includes(w));

  if(isEmergency){ CASE="EMERGENCY"; LOCK=true; }
  else if(isHigh || MSG_COUNT>=3){ LOCK=true; }

  const persona=detectPersona(t);
  let risk=PERSONA[persona].base + (NIGHT?1:0);

  // Hard stop
  if(LOCK){
    if(CASE==="EMERGENCY"){
      EM++; document.getElementById("ec").textContent=EM;
      add("bot",`
        <strong>‡πÄ‡∏Ñ‡∏™‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${NIGHT?"(‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)":""} ¬∑ Risk ${risk}/10</strong><br>
        ${NIGHT
          ?"‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ä‡∏ó‡∏≠‡∏≤‡∏à‡∏Å‡πà‡∏≠‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"
          :"‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πà‡∏≤‡∏¢‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"}
        <div class="cta">
          <strong>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</strong>
          <a class="call" href="tel:${PHONE}">üìû ‡πÇ‡∏ó‡∏£‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</a>
        </div>
      `);
    }else{
      NR++; document.getElementById("nc").textContent=NR;
      add("bot",`
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <strong>${risk}/10</strong><br>
        ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
        <div class="cta">
          <strong>‡∏Å‡∏≤‡∏£‡πÇ‡∏ó‡∏£‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</strong>
          <a class="call" href="tel:${PHONE}">üìû ‡πÇ‡∏ó‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ä‡πà‡∏≤‡∏á</a>
          <a class="line" href="${LINE_URL}">üí¨ LINE</a>
        </div>
      `);
    }
    input.disabled=true; return;
  }

  // AI analysis (short, refuse-to-guess)
  try{
    const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,{
      method:"POST", headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        contents:[{role:"user",parts:[{text:t}]}],
        systemInstruction:{parts:[{text:PERSONA[persona].prompt+`
‡∏´‡πâ‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏´‡πâ‡∏≤‡∏°‡∏ô‡∏±‡∏î
‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ä‡∏ó
‡∏û‡∏π‡∏î‡∏™‡∏±‡πâ‡∏ô ‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•`}]} })
    });
    const d=await r.json();
    add("bot", d.candidates?.[0]?.content?.parts?.[0]?.text || "‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö");
  }catch{
    add("bot", "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á");
  }
}
</script>

</body>
</html>
