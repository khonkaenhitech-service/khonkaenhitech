<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AI Risk Control | KhonKaen HiTech</title>

<style>
:root{--gold:#d4af37;--red:#ff4d4d;--green:#2ecc71}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,Segoe UI;background:#0c0f14;color:#eee}
header{padding:14px;text-align:center;border-bottom:3px solid var(--gold)}
h1{margin:0;color:var(--gold);font-size:1.2rem}
small{color:#aaa}
#app{max-width:920px;margin:auto}
.chat{padding:14px;min-height:62vh}
.msg{margin-bottom:12px}
.user{text-align:right}
.bubble{display:inline-block;max-width:88%;padding:13px;border-radius:14px;line-height:1.6}
.user .bubble{background:#263445;border-bottom-right-radius:4px}
.bot .bubble{background:#1a202c;border-left:5px solid var(--gold)}
.input{display:flex;gap:8px;padding:12px;border-top:1px solid #222}
input{flex:1;padding:14px;border-radius:8px;border:none;font-size:1rem}
button{padding:0 18px;border:none;border-radius:8px;background:var(--gold);font-weight:800}
.cta{margin-top:12px;padding:14px;border:2px solid var(--gold);border-radius:12px;background:#0b0e13}
.cta strong{color:var(--red)}
.cta a{display:block;margin-top:10px;padding:14px;border-radius:8px;text-align:center;text-decoration:none;font-weight:900}
.call{background:var(--red);color:#fff}
.line{background:var(--green);color:#111}
#dash{position:fixed;right:10px;bottom:10px;background:#000;padding:10px;border-radius:10px;font-size:.75rem;opacity:.9}
@media(max-width:520px){
  .bubble{max-width:92%}
  button{padding:0 14px}
}
</style>
</head>

<body>

<header>
  <h1>ระบบควบคุมความเสี่ยง</h1>
  <small>ขอนแก่นไฮเทค · เลือกผิด = เสียหาย</small>
</header>

<div id="app">
  <div class="chat" id="chat">
    <div class="msg bot"><div class="bubble">
      ผมคือระบบประเมินความเสี่ยงเบื้องต้นของขอนแก่นไฮเทค<br>
      หน้าที่ของผมไม่ใช่การขาย แต่คือป้องกันการตัดสินใจผิดที่อาจลุกลามเป็นความเสียหายรุนแรง<br><br>
      โปรดอธิบายอาการหรือปัญหาที่พบครับ
    </div></div>
  </div>

  <div class="input">
    <input id="input" placeholder="พิมพ์อาการที่พบ…" />
    <button onclick="send()">ส่ง</button>
  </div>
</div>

<div id="dash">
  Emergency: <span id="ec">0</span><br>
  Normal: <span id="nc">0</span>
</div>

  <script>
function send(){
  const input = document.getElementById("input"); // ✅ เพิ่มบรรทัดนี้
  const t = input.value.trim();
  if(!t) return;

  input.value = "";
  add("user", t);
  add("bot", contextAwareResponse(t));
}

</script>


  <script>
/* ================= OPTION ENGINE ================= */

const AI_OPTIONS = {

  /* ---------- BEHAVIOR CONTROL ---------- */
  behavior: {
    maxMessages: 3,                 // จำกัดจำนวนข้อความ AI
    silentAfterCTA: true,           // เงียบหลัง CTA
    refuseToGuess: true,            // กล้าปฏิเสธ
    authorityTone: true,            // โทนผู้เชี่ยวชาญ
    nightAggressive: true,          // กลางคืนแรงขึ้น
    emergencyOneShot: true          // ฉุกเฉินตอบครั้งเดียว
  },

  /* ---------- RISK SYSTEM ---------- */
  risk: {
    enableScore: true,
    baseScore: 3,
    nightBonus: 1,
    emergencyBonus: 3,
    maxScore: 10,
    displayText: [
      "ต่ำ", "พอควร", "ควรระวัง", "เสี่ยง",
      "เสี่ยงสูง", "อันตราย"
    ]
  },

  /* ---------- PSYCHOLOGY LAYERS ---------- */
  psychology: {
    fearEscalation: true,
    decisionWindow: true,
    lossAversion: true,
    authorityBias: true,
    silencePressure: true,
    responsibilityFrame: true
  },

  /* ---------- TIME MODES ---------- */
  timeMode: {
    day: {
      tone: "calm",
      allowAnalysis: true
    },
    night: {
      tone: "hard",
      allowAnalysis: false,
      autoEmergencyBias: true
    }
  },

  /* ---------- SERVICE NEUTRAL CONTROL ---------- */
  unifiedService: {
    useSystemWord: true,
    avoidHowTo: true,
    avoidFixGuide: true,
    focusOnImpact: true
  },

  /* ---------- CTA CONTROL ---------- */
  cta: {
    allowLine: true,
    allowPhone: true,
    hideOtherActions: true,
    preCallPriming: true,
    postCallReassurance: true
  },

  /* ---------- SAFETY & COMPLIANCE ---------- */
  safety: {
    noMedicalAdvice: true,
    noLegalAdvice: true,
    noDIY: true,
    noGuarantee: true
  },

  /* ---------- LOGGING / DASHBOARD ---------- */
  dashboard: {
    enable: true,
    countEmergency: true,
    countNormal: true,
    sessionTrace: true
  },

  /* ---------- MOBILE-FIRST ---------- */
  mobile: {
    shortSentence: true,
    largeCTA: true,
    oneThumbFlow: true,
    noLongParagraph: true
  },

  /* ---------- EXPERIMENTAL (เปิดทีหลังได้) ---------- */
  experimental: {
    stressTestWords: false,
    adaptiveRiskLearning: false,
    voiceToneSimulate: false,
    microDelayPsychology: false
  }
};
</script>

  <script>
function opt(path) {
  return path.split('.').reduce((o,i)=>o?.[i], AI_OPTIONS);
}

function isNightMode() {
  const h = new Date().getHours();
  return h >= 20 || h < 6;
}

function riskScore(base, emergency=false) {
  let r = base;
  if (isNightMode()) r += opt("risk.nightBonus");
  if (emergency) r += opt("risk.emergencyBonus");
  return Math.min(r, opt("risk.maxScore"));
}
</script>

  <script>
function buildAuthorityMessage(text) {
  if (!opt("psychology.authorityBias")) return text;
  return "ผมขอพูดในฐานะผู้รับผิดชอบนะครับ\n" + text;
}

function buildDecisionPressure(text) {
  if (!opt("psychology.decisionWindow")) return text;
  return text + "\nการตัดสินใจจากข้อมูลไม่ครบในจุดนี้ มีต้นทุนที่มองไม่เห็น";
}
</script>

  <script>
function emergencyOverride() {
  return `
⚠️ เข้าข่ายเคสฉุกเฉิน${isNightMode()?"ช่วงกลางคืน":""}
ไม่ควรประเมินต่อผ่านระบบอัตโนมัติ

เพื่อความปลอดภัย
กรุณาติดต่อผู้ชำนาญการโดยตรง
`;
}
</script>

  <script>
/* ================= PSYCHOLOGY PHRASE LIBRARY ================= */

const PHRASE_LIBRARY = {

  /* ---------- AUTHORITY / TRUST ---------- */
  authority: {
    open: [
      "ผมขอพูดในฐานะผู้รับผิดชอบด้านความปลอดภัยโดยตรงนะครับ",
      "จากประสบการณ์ที่เจอเคสลักษณะนี้มาจริง",
      "ในมุมของผู้ที่ต้องรับผลลัพธ์หลังการตัดสินใจ",
      "ถ้ามองในเชิงระบบและความเสี่ยง",
      "ผมจำเป็นต้องอธิบายตามข้อเท็จจริง"
    ],
    close: [
      "ผมไม่อยากให้คุณตัดสินใจจากข้อมูลที่ยังไม่ครบ",
      "ความระมัดระวังในจุดนี้คือสิ่งที่คุ้มค่าที่สุด",
      "การตัดสินใจผิดพลาดตรงนี้ แก้กลับได้ยาก",
      "หน้าที่ของผมคือป้องกันความเสียหายที่ไม่จำเป็น",
      "ผมเลือกพูดตรง เพื่อไม่ให้คุณต้องเสียใจภายหลัง"
    ]
  },

  /* ---------- RISK ESCALATION ---------- */
  risk: {
    mild: [
      "อาการลักษณะนี้มักไม่จบแค่จุดเดียว",
      "ปัญหาประเภทนี้มักซ่อนผลกระทบมากกว่าที่เห็น",
      "ช่วงแรกอาจยังใช้งานได้ แต่ความเสี่ยงกำลังสะสม",
      "หลายคนมองข้ามจุดนี้ เพราะยังไม่เห็นผลทันที",
      "สิ่งที่เห็นอาจเป็นเพียงส่วนหนึ่งของปัญหา"
    ],
    strong: [
      "เมื่อปัญหาประเภทนี้ข้ามจุดหนึ่งไปแล้ว ความเสียหายจะเกิดเร็วมาก",
      "ความคลาดเคลื่อนเพียงเล็กน้อย อาจเปลี่ยนระดับความเสียหายทันที",
      "หลายเคสที่ปล่อยไว้ มักจบด้วยค่าแก้ไขที่ไม่ควรเกิด",
      "ปัญหานี้ไม่เหมาะกับการลองผิดลองถูก",
      "จุดนี้คือช่วงที่การประเมินผิดพลาดส่งผลหนักที่สุด"
    ]
  },

  /* ---------- DECISION PRESSURE ---------- */
  decision: {
    window: [
      "เคสลักษณะนี้มักมีช่วงเวลาที่จัดการได้อย่างปลอดภัย",
      "ตอนนี้ยังอยู่ในจุดที่สามารถควบคุมความเสียหายได้",
      "หากข้ามช่วงนี้ไป ทางเลือกจะเหลือน้อยลงมาก",
      "การตัดสินใจในระยะนี้ส่งผลกับค่าเสียหายในระยะยาว",
      "ความเร็วในการตัดสินใจที่ถูกต้อง สำคัญกว่าความเร็วในการแก้ไข"
    ],
    loss: [
      "การประหยัดผิดจุด มักทำให้ต้องจ่ายแพงกว่าเดิม",
      "หลายคนเสียมากกว่าเดิม เพราะตัดสินใจช้าเกินไป",
      "ค่าเสียหายที่มองไม่เห็น มักแพงกว่าที่คิด",
      "สิ่งที่ควรป้องกันวันนี้ มักกลายเป็นปัญหาใหญ่วันหน้า",
      "การชะลอการตัดสินใจบางครั้ง คือการเพิ่มต้นทุนโดยไม่รู้ตัว"
    ]
  },

  /* ---------- EMERGENCY (DAY) ---------- */
  emergency_day: [
    "จากข้อมูลที่แจ้ง เข้าข่ายเคสฉุกเฉิน ไม่ควรใช้งานต่อ",
    "อาการลักษณะนี้ไม่เหมาะกับการประเมินผ่านข้อความ",
    "มีความเสี่ยงที่อาจเกิดผลกระทบทันทีหากประเมินผิด",
    "กรณีนี้ควรหยุดการประเมินผ่านระบบอัตโนมัติ",
    "เพื่อความปลอดภัย แนะนำให้ผู้ชำนาญการดูแลโดยตรง"
  ],

  /* ---------- EMERGENCY (NIGHT) ---------- */
  emergency_night: [
    "ช่วงเวลากลางคืนจัดเป็นช่วงความเสี่ยงสูง",
    "การประเมินผิดพลาดในช่วงนี้อาจก่ออันตรายทันที",
    "ไม่ควรดำเนินการใด ๆ ต่อผ่านระบบอัตโนมัติ",
    "กรณีฉุกเฉินช่วงกลางคืนต้องระมัดระวังเป็นพิเศษ",
    "เพื่อป้องกันอันตราย ควรติดต่อผู้ชำนาญการทันที"
  ],

  /* ---------- CTA / TRANSFER ---------- */
  transfer: [
    "การโทรพูดคุยกับผู้ชำนาญการคือทางเลือกที่ปลอดภัยที่สุด",
    "เพื่อให้ประเมินได้ครบถ้วน ควรให้ผู้เชี่ยวชาญดูแลต่อ",
    "ผมไม่แนะนำให้ตัดสินใจจากแชทในจุดนี้",
    "การติดต่อโดยตรงช่วยลดความคลาดเคลื่อนในการประเมิน",
    "ให้ผู้ชำนาญการดูแลต่อ จะปลอดภัยกว่ามาก"
  ],

  /* ---------- POST-CALL TRUST ---------- */
  reassurance: [
    "การติดต่อผู้ชำนาญการโดยตรง เป็นการตัดสินใจที่รอบคอบ",
    "คุณเลือกป้องกันความเสี่ยงได้ถูกจังหวะแล้ว",
    "การตัดสินใจครั้งนี้ช่วยลดความเสียหายที่ไม่จำเป็น",
    "ถือเป็นการตัดสินใจที่ปลอดภัยที่สุดในสถานการณ์นี้",
    "คุณทำถูกแล้วที่ไม่ตัดสินใจจากข้อมูลไม่ครบ"
  ]
};

/* ================= GENERATOR ================= */

function pick(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

function getPhrase(category){
  const group = PHRASE_LIBRARY[category];
  if(!group) return "";
  if(Array.isArray(group)) return pick(group);
  // object with subgroups
  const keys = Object.keys(group);
  return pick(group[pick(keys)]);
}

/* ================= COMPOSED MESSAGE ================= */
// ตัวอย่างการประกอบประโยคให้ได้เป็นพันรูปแบบ
function buildMessage(flow){
  return [
    getPhrase("authority"),
    getPhrase("risk"),
    getPhrase("decision"),
    getPhrase(flow)
  ].filter(Boolean).join(" ");
}
</script>

<script>
PHRASE_LIBRARY.legal_safety = [
  "ในฐานะผู้รับผิดชอบด้านความปลอดภัย ผมไม่สามารถแนะนำให้ประเมินต่อผ่านแชทได้",
  "หากประเมินผิดพลาดในจุดนี้ อาจก่อให้เกิดความเสียหายที่ไม่สามารถย้อนกลับได้",
  "เพื่อหลีกเลี่ยงความเสี่ยงที่อาจเกิดอันตราย ผมจำเป็นต้องหยุดการประเมินผ่านระบบอัตโนมัติ",
  "กรณีลักษณะนี้ การให้คำแนะนำผ่านข้อความอาจไม่ปลอดภัย",
  "ผมไม่สามารถรับรองความปลอดภัยได้ หากยังประเมินจากข้อมูลเท่านี้",
  "ความคลาดเคลื่อนเพียงเล็กน้อยในสถานการณ์นี้ อาจนำไปสู่อันตรายโดยตรง",
  "ตามหลักความปลอดภัย ไม่ควรดำเนินการใด ๆ ต่อโดยไม่มีการประเมินจากผู้ชำนาญการ",
  "เพื่อป้องกันความเสียหายที่อาจกระทบต่อชีวิตหรือทรัพย์สิน จำเป็นต้องให้ผู้เชี่ยวชาญดูแลต่อ",
  "การหยุดการประเมินในจุดนี้ เป็นการรับผิดชอบต่อความปลอดภัยของคุณ",
  "ผมเลือกหยุด ไม่ใช่เพราะไม่รู้ แต่เพราะไม่ต้องการให้เกิดความเสี่ยงที่ไม่จำเป็น"
];
</script>

  <script>
PHRASE_LIBRARY.mobile_short = [
  "เข้าข่ายเสี่ยงสูง ไม่ควรประเมินต่อ",
  "กรณีนี้ควรหยุดทันที",
  "ประเมินผ่านแชทมีความเสี่ยง",
  "เพื่อความปลอดภัย แนะนำให้โทร",
  "จุดนี้ไม่ควรลองผิดลองถูก",
  "เสี่ยงเกินกว่าจะประเมินจากข้อความ",
  "ติดต่อผู้ชำนาญการโดยตรงจะปลอดภัยกว่า",
  "อย่าตัดสินใจจากข้อมูลไม่ครบ",
  "โทรคุยจะปลอดภัยที่สุด",
  "หยุดตรงนี้ แล้วติดต่อช่าง"
];
</script>

  <script>
PHRASE_LIBRARY.call_close = [
  "สรุปตามที่คุยกัน การจัดการตอนนี้จะช่วยป้องกันความเสียหายที่ไม่จำเป็นครับ",
  "ผมจะดูแลเคสนี้ให้รอบคอบ เพื่อให้จบจริงและไม่เกิดปัญหาซ้ำ",
  "การตัดสินใจครั้งนี้ เป็นทางเลือกที่ปลอดภัยที่สุดในสถานการณ์นี้ครับ",
  "ผมรับดูแลต่อให้ทั้งหมด เพื่อไม่ให้คุณต้องเสี่ยงกับการตัดสินใจผิด",
  "จากข้อมูลทั้งหมด แนวทางนี้คือวิธีที่เหมาะสมที่สุดแล้วครับ",
  "ผมจะจัดการให้ตามมาตรฐาน เพื่อไม่ให้เกิดความเสียหายเพิ่ม",
  "คุณตัดสินใจถูกจังหวะแล้วครับ",
  "เคสนี้ยังอยู่ในจุดที่ควบคุมได้ และเราจะจัดการให้เรียบร้อย",
  "หลังจากนี้ ผมจะดูแลต่อให้ทั้งหมด คุณไม่ต้องกังวลครับ",
  "ผมขอสรุปว่าแนวทางนี้คุ้มค่าและปลอดภัยที่สุดแล้ว"
];
</script>



  <script>
PHRASE_LIBRARY.resistance = [
  "ผมเข้าใจมุมมองของคุณครับ แต่หน้าที่ของผมคือชี้ความเสี่ยงตามข้อเท็จจริง",
  "กรณีนี้ความเห็นส่วนบุคคลอาจไม่พอ ต้องดูผลกระทบที่ตามมา",
  "หลายเคสที่เริ่มต้นจากความมั่นใจ มักจบด้วยค่าเสียหายที่ไม่ตั้งใจ",
  "ผมไม่ได้โต้แย้ง แต่จำเป็นต้องย้ำความเสี่ยงที่เกิดขึ้นจริง",
  "หากเลือกมองข้ามจุดนี้ ผลลัพธ์มักไม่เป็นไปตามที่คาดหวัง",
  "ผมขออธิบายตามข้อมูลที่เห็น ไม่ใช่ตามความรู้สึก",
  "การตัดสินใจจากข้อมูลไม่ครบ คือความเสี่ยงที่ผมไม่อยากให้คุณรับ",
  "ผมเลือกเตือนตรงนี้ เพื่อไม่ให้เกิดปัญหาภายหลัง",
  "ความระมัดระวังในจุดนี้คือเหตุผลที่หลายเคสไม่ลุกลาม",
  "ผมขอให้คุณพิจารณาจากผลลัพธ์ระยะยาวมากกว่าความสบายใจชั่วคราว"
];
</script>

  <script>
PHRASE_LIBRARY.price_objection = [
  "จุดนี้ไม่ใช่เรื่องราคาถูกหรือแพง แต่เป็นเรื่องความเสี่ยงหากประเมินผิด",
  "การตัดสินใจจากราคาอย่างเดียว มักทำให้ค่าใช้จ่ายเพิ่มในภายหลัง",
  "สิ่งที่ต่างไม่ใช่ตัวเลข แต่คือผลลัพธ์หลังการแก้ไข",
  "ราคาที่ถูกกว่า อาจมาพร้อมต้นทุนที่มองไม่เห็น",
  "การจัดการให้จบตั้งแต่ต้น มักคุ้มกว่าการแก้ซ้ำ",
  "หลายเคสที่เลือกจากราคา ต้องกลับมาแก้ใหม่อีกครั้ง",
  "ความคุ้มค่าในงานนี้ วัดจากความปลอดภัยและความเสถียร",
  "ค่าใช้จ่ายที่ประหยัดวันนี้ อาจกลายเป็นค่าเสียหายวันหน้า",
  "ผมไม่อยากให้คุณตัดสินใจจากตัวเลขเพียงอย่างเดียว",
  "ความต่างของราคามักสะท้อนความต่างของมาตรฐาน"
];
</script>

  <script>
PHRASE_LIBRARY.hesitation = [
  "การขอเวลาคิดเป็นเรื่องปกติครับ แต่อย่าลืมว่าความเสี่ยงยังคงอยู่",
  "หลายเคสที่ลังเลนานเกินไป มักพลาดช่วงที่จัดการได้ง่าย",
  "จุดนี้ยังอยู่ในช่วงที่ควบคุมได้ ซึ่งไม่ใช่ทุกเคสจะมีโอกาสนี้",
  "การตัดสินใจช้า บางครั้งคือการเพิ่มความเสี่ยงโดยไม่ตั้งใจ",
  "ผมแนะนำให้คิดบนพื้นฐานของผลกระทบ ไม่ใช่แค่ความรู้สึก",
  "หากต้องคิดต่อ แนะนำให้คุยกับผู้ชำนาญการก่อนเพื่อข้อมูลครบ",
  "การมีข้อมูลครบจะช่วยให้ตัดสินใจได้มั่นใจกว่า",
  "จังหวะนี้คือช่วงที่ยังป้องกันความเสียหายเพิ่มได้",
  "ผมไม่อยากให้คุณพลาดช่วงเวลาที่ปลอดภัยที่สุด",
  "การตัดสินใจที่ถูกจังหวะ มักช่วยลดต้นทุนในระยะยาว"
];
</script>

  <script>
PHRASE_LIBRARY.has_technician = [
  "มีผู้ดูแลอยู่แล้วเป็นเรื่องดีครับ แต่อย่าลืมตรวจมุมความเสี่ยงทั้งหมด",
  "ช่างแต่ละคนถนัดไม่เหมือนกัน การประเมินรอบด้านช่วยลดความพลาด",
  "หลายเคสที่มีคนดูให้แล้ว ยังมีจุดเสี่ยงที่ไม่ถูกสังเกต",
  "การมีมุมมองที่สอง ช่วยป้องกันการประเมินคลาดเคลื่อน",
  "ผมแนะนำให้ตรวจผลกระทบต่อระบบทั้งหมด ไม่ใช่แค่จุดที่เห็น",
  "ความเสียหายมักเกิดจากจุดที่คิดว่าไม่น่ามีปัญหา",
  "การตรวจซ้ำในเคสเสี่ยง เป็นเรื่องของความปลอดภัย",
  "การประเมินต่างมุม ช่วยลดโอกาสเกิดปัญหาซ้ำ",
  "มีช่างดูแลอยู่แล้วก็ยังควรระวังจุดลุกลาม",
  "การตรวจทานเพิ่ม เป็นการป้องกัน ไม่ใช่การไม่ไว้ใจ"
];
</script>

  <script>
PHRASE_LIBRARY.still_working = [
  "อุปกรณ์ที่ยังใช้งานได้ ไม่ได้แปลว่าปลอดภัย",
  "หลายปัญหาไม่แสดงอาการจนกว่าจะถึงจุดหนึ่ง",
  "ช่วงที่ยังใช้งานได้ มักเป็นช่วงที่เสี่ยงที่สุด",
  "ความเสียหายบางอย่างเกิดขึ้นแบบไม่เตือนล่วงหน้า",
  "การรอให้พัง มักทำให้ทางเลือกเหลือน้อย",
  "อาการเงียบไม่ได้หมายถึงปัญหาหายไป",
  "การทำงานปกติ อาจเป็นเพียงภาพภายนอก",
  "หลายเคสเสียหายหนัก เพราะคิดว่ายังไม่เป็นอะไร",
  "ช่วงนี้ยังเป็นจุดที่ป้องกันได้",
  "ผมไม่อยากให้คุณเจอปัญหาแบบฉับพลัน"
];
</script>

  <script>
PHRASE_LIBRARY.deescalate = [
  "ผมขอให้คุณตั้งสติก่อนนะครับ เรามาดูความเสี่ยงตามลำดับ",
  "อาการนี้ยังอยู่ในขั้นที่ต้องประเมินอย่างรอบคอบ",
  "การตัดสินใจด้วยความกังวล อาจทำให้พลาดข้อมูลสำคัญ",
  "เราจะจัดการทีละขั้น เพื่อให้ปลอดภัยที่สุด",
  "ผมอยู่ตรงนี้เพื่อช่วยป้องกันความเสียหาย",
  "ขอให้เรายึดข้อมูลเป็นหลัก จะช่วยให้ตัดสินใจได้ดีขึ้น",
  "สถานการณ์นี้ต้องใช้ความรอบคอบมากกว่าความรีบ",
  "เรายังมีทางเลือกที่ปลอดภัยอยู่",
  "ผมแนะนำให้คุยกับผู้ชำนาญการโดยตรงเพื่อความมั่นใจ",
  "การตั้งสติคือจุดเริ่มต้นของการแก้ปัญหาที่ถูกต้อง"
];
</script>

  <script>
const BEHAVIOR_SIGNALS = {
  emergency: [
    "ไฟไหม้","ควัน","กลิ่นไหม้","ประกายไฟ",
    "ไฟดูด","ช็อต","เบรกเกอร์ตัด","ร้อนจัด"
  ],
  price: [
    "ราคา","แพง","ถูก","คุ้ม","เทียบ","ร้านอื่น"
  ],
  hesitation: [
    "ขอคิดดูก่อน","ขอดูก่อน","ยังไม่แน่ใจ","ลังเล"
  ],
  resistance: [
    "ไม่เชื่อ","ไม่น่าจะ","ไม่น่ามีปัญหา","เคยทำแล้ว"
  ],
  still_working: [
    "ยังใช้ได้","ยังปกติ","ไม่เป็นไร","ใช้งานได้"
  ],
  has_technician: [
    "มีช่างแล้ว","ให้ช่างดูแล้ว","มีคนดูให้แล้ว"
  ],
  panic: [
    "กลัวมาก","ตกใจ","เครียด","กังวลมาก","จะพังไหม"
  ]
};
</script>

  <script>
const BEHAVIOR_TO_PACK = [
  { match: "emergency", pack: "legal_safety" },
  { match: "panic", pack: "deescalate" },
  { match: "price", pack: "price_objection" },
  { match: "hesitation", pack: "hesitation" },
  { match: "has_technician", pack: "has_technician" },
  { match: "still_working", pack: "still_working" },
  { match: "resistance", pack: "resistance" }
];
</script>

  <script>
function detectBehavior(text){
  const found = [];
  for(const type in BEHAVIOR_SIGNALS){
    if(BEHAVIOR_SIGNALS[type].some(w => text.includes(w))){
      found.push(type);
    }
  }
  return found;
}
</script>

  <script>
function autoSelectPhrase(text){
  const behaviors = detectBehavior(text);

  for(const rule of BEHAVIOR_TO_PACK){
    if(behaviors.includes(rule.match)){
      return getPhrase(rule.pack);
    }
  }

  // fallback กลาง ๆ
  return buildMessage("transfer");
}
</script>


<script>
const BEHAVIOR_WEIGHT = {
  emergency: 100,        // ฉุกเฉิน ชนะทุกอย่าง
  panic: 40,
  resistance: 30,
  price: 25,
  hesitation: 20,
  still_working: 20,
  has_technician: 15
};
</script>

<script>
function calculateBehaviorScore(text){
  let score = 0;
  const detected = detectBehavior(text);

  detected.forEach(type=>{
    score += BEHAVIOR_WEIGHT[type] || 0;
  });

  return {
    score,
    detected
  };
}
</script>


  <script>
function getEscalationLevel(score){
  if(score >= 100) return "EMERGENCY";
  if(score >= 60)  return "HIGH";
  if(score >= 35)  return "MEDIUM";
  return "LOW";
}
</script>

  <script>
function selectPackByScore(text){
  const { score, detected } = calculateBehaviorScore(text);
  const level = getEscalationLevel(score);

  // ฉุกเฉินจริง
  if(level === "EMERGENCY"){
    return getPhrase("legal_safety");
  }

  // พฤติกรรมซ้อนแรง
  if(level === "HIGH"){
    return getPhrase("resistance") + " " + getPhrase("price_objection");
  }

  if(level === "MEDIUM"){
    return autoSelectPhrase(text);
  }

  // LOW
  return buildMessage("transfer");
}
</script>

  <script>
const CONTEXT_MEMORY = {
  count: {},
  lastEscalation: "LOW"
};
</script>


  <script>
function updateContextMemory(detected){
  detected.forEach(type=>{
    CONTEXT_MEMORY.count[type] = (CONTEXT_MEMORY.count[type] || 0) + 1;
  });
}
</script>


  <script>
function hasRepeatedBehavior(threshold = 2){
  return Object.values(CONTEXT_MEMORY.count)
    .some(v => v >= threshold);
}
</script>


  <script>
function contextAwareResponse(text){
  const { score, detected } = calculateBehaviorScore(text);
  updateContextMemory(detected);

  let level = getEscalationLevel(score);

  // ถ้าพฤติกรรมซ้ำ → ยกระดับอัตโนมัติ
  if(hasRepeatedBehavior()){
    if(level === "LOW") level = "MEDIUM";
    else if(level === "MEDIUM") level = "HIGH";
  }

  CONTEXT_MEMORY.lastEscalation = level;

  // เลือก Pack ตามระดับใหม่
  switch(level){
    case "EMERGENCY":
      return getPhrase("legal_safety");
    case "HIGH":
      return getPhrase("resistance") + " " + getPhrase("decision");
    case "MEDIUM":
      return autoSelectPhrase(text);
    default:
      return buildMessage("transfer");
  }
}
</script>


  
  


  

  
</body>
</html>
